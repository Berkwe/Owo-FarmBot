
import discord, time, random, asyncio, os, json, subprocess
from discord.ext import commands

settingsJs = """{
"Botun_Tokeni": "",
"Oynanacak_Hesabƒ±nƒ±zƒ±n_Tokeni": "",
"Oynanacak_Kanalƒ±n_ƒ∞dsi": "",
"Oynanacak_Sunucunun_idsi": "",
"Komutlara_eri≈üimi_olan_hesabƒ±n_idsi": ""
}"""
dir_path = os.path.dirname(os.path.abspath(__file__))
file_path = os.path.join(dir_path, "settings.json")
if not os.path.exists(file_path):
    with open(file_path, "w", encoding="utf-8") as f:
        f.write(settingsJs)
    raise ValueError("Settings.json dosyasƒ± bulunamadƒ±ƒüƒ± i√ßin bir tane olu≈üturuldu. L√ºtfen bilgilerinizi doƒüru ve EKSƒ∞KSƒ∞Z ≈üekilde girin.")

with open(file_path, "r", encoding="utf-8") as f:
    settings = json.load(f)

import DiscordClient

# BOT Token
TOKEN = settings["Botun_Tokeni"]
# SELF TOKEN
selfToken = settings["Oynanacak_Hesabƒ±nƒ±zƒ±n_Tokeni"]
# OWO Channel id
channel = int(settings["Oynanacak_Kanalƒ±n_ƒ∞dsi"])
# OWO Server ƒ∞D
server_id = int(settings["Oynanacak_Sunucunun_idsi"])
# Manager id
manager_id = int(settings["Komutlara_eri≈üimi_olan_hesabƒ±n_idsi"])

# Settings #

# Bot prefix
prefix = "-"
# Startup OWO
defaultAmount = 100
amount = defaultAmount
amounts = []
# Captcha protection
captchaProtection = True
# if antiChaptca true,  After how many attempts should it be stopped?
cfLimit = 16
# Dell random messages? (in lst)
dellRandoms = False
# Owo pray bot?
owoPray = True
prayTime = 251
# Limit the spent money
loseTrigger = False
limitValue = 100000
# Randoms list
lst = ["owo battle", "ehue", "hebele", "rastgele", "kelimeler",
        "owo h", "hey", "ahali", "zombi", "mahali", "acƒ±larƒ±nƒ±"]


# Don't touch
isBotRunning = True
currentlyTime = int(time.time())
isPause = False
isCont = True
won = False
# OWO Bot id
bot_id = 408785106942164992
# ƒ∞f losing streak
losingStreak = 0
# For cooldown
message_ids = [0, 1]
# For captchaProtection
cfValue = [0, 0]
hebele = False
# For profit calculate
cashControlVal = 0
# Discord settings
intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix=prefix, intents=intents, )


async def main():
    global won, amount, limitValue, bot_channel, currentlyTime
    if amounts:
        for amount in amounts:
            while isCont and isBotRunning:
                if won == True:
                    amounts.remove(amount)
                    break
               
                if amount*2 > 250000 and isCont:
                    b√∂l√º = 2
                    print("LOG : 250000 √ºst√º amount belirlendi, Amounts.amount b√∂l√ºn√ºyor.")
                    while amount//b√∂l√º < 250000:
                            b√∂l√º += 1
                            continue
                    for _ in range(b√∂l√º):
                        amounts.append(amount//b√∂l√º)

                print("\nScattered Amount :", amount)
                await DiscordClient.g√∂nder(message=f"owo cf {amount}", server_id=server_id, channel_id=channel)
                cfValue[1]  += 1
                currentlyTime = int(time.time())
                await asyncio.sleep(1)
                await DiscordClient.g√∂nder(message=random.choice(lst), server_id=server_id, channel_id=channel)
                if isCont:
                    amount *= 2
                await asyncio.sleep(13)
        
    else:
        while isCont and isBotRunning:
            if won == True:
                amount = defaultAmount
                won = False
            
            elif loseTrigger and amount >= limitValue:
            
                await user.send(f"USTA! {limitValue} owo kaybedildi, haberin olsun.")
                amount = defaultAmount

            if amount*2 > 250000 and isCont:
                    b√∂l√º = 2
                    print("LOG : 250000 √ºst√º amount belirlendi, amount b√∂l√ºn√ºyor.")
                    while amount//b√∂l√º < 250000:
                            b√∂l√º += 1
                            continue
                    for _ in range(b√∂l√º):
                        amounts.append(amount//b√∂l√º)
    
            print("\nAmount :", amount)
            await DiscordClient.g√∂nder(message=f"owo cf {amount}", server_id=server_id, channel_id=channel)
            cfValue[1]  += 1
            currentlyTime = int(time.time())
            await asyncio.sleep(1)
            await DiscordClient.g√∂nder(message=random.choice(lst), server_id=server_id, channel_id=channel)
            if isCont:
                amount *= 2
            await asyncio.sleep(13)

@bot.event
async def on_disconnect():
    global isCont, main_task, TOKEN

    print('LOG : Bot disconnected. Attempting to reconnect...')
    await asyncio.sleep(5)  
    await bot.close()  
    await asyncio.sleep(2)
    await bot.start(TOKEN) 
    isCont = True
    main_task = asyncio.create_task(main())
    await main_task


@bot.event
async def on_ready():
    global user, bot_channel, main_task
    activity = discord.Activity(
        type=discord.ActivityType.watching, name="Pornhub")
    await bot.change_presence(activity=activity)
    await DiscordClient.ClientLogin(bot)
    user = await bot.fetch_user(manager_id)
    bot_channel = bot.get_channel(channel)
    main_task = asyncio.create_task(main())
    await main_task


async def profit_loss(message):
    global cashControlVal
    embed = discord.Embed(
    title="„Ö§„Ö§üìà**Kar-Zarar Durumu**üìà„Ö§„Ö§",
    description=f"||<@{message.author.id}>||",
    color=discord.Color.gold()
    )
    if cashControlVal > 0:
        embed.add_field(
            name='\u200B',
            value='',
            inline=False
        )
        print(f"\nLOG : Profit-loss : +{cashControlVal}.")
        embed.add_field(
        name='**Durum : **',
        value=f'\n\n* Kar : **+{cashControlVal}**',
        inline=False
        )
    elif cashControlVal < 0:
        embed.add_field(
            name='\u200B',
            value='',
            inline=False
        )
        print(f"\nLOG : Profit-loss : {cashControlVal}.")
        embed.add_field(
        name='**Durum : **',
        value=f'\n\n* Zarar : **{cashControlVal}**',
        inline=False
        )
    else:
        embed.add_field(
            name='\u200B',
            value='',
            inline=False
        )
        print(f"\nLOG : Profit-loss : 0.")
        embed.add_field(
        name='**Durum : **',
        value='\n\n* **Hi√ß owo kazanƒ±p kaybetmemi≈üsiniz.**',
        inline=False
        )
    await message.channel.send(embed=embed)


@bot.event
async def on_message(message):
    global defaultAmount, isCont, main_task, dellRandoms, cfLimit, captchaProtection, cfValue, prefix ,isPause, isBotRunning
    if int(time.time())-currentlyTime > 15 and cfValue[1]-cfValue[0] > 1:
        isBotRunning = False
        isPause = True
    if message.author.id == bot_id and message.channel.id == channel:
        if "Slow down" in message.content and not hebele and int(message.content.replace("_", "").replace("*", "").replace(",", "").replace(">", "").replace("<", "").replace("R", "").replace("t", "").replace(":", "").split()[10]) < (int(time.time())+20):
            print("\nLOG : Cooldown...")
            isPause = True
            main_task.cancel()
            isCont = False
            while True:
                try:
                    await bot_channel.fetch_message(message.id)
                except discord.errors.NotFound:
                    break
            await DiscordClient.sil(message_ids[0], server_id=server_id, channel_id=channel)
            await DiscordClient.sil(message_ids[1], server_id=server_id, channel_id=channel)
            isPause = False
            isCont = True
            main_task = asyncio.create_task(main())
            await main_task

        elif "complete your captcha" in message.content:
            print("\nLOG : Captcha detected, Program suspended...")
            isCont = False
            main_task.cancel()
            await user.send("Captcha tespit edildi, l√ºtfen captchayƒ± tamamlayƒ±n.")

    if message.author == bot.user:
        return

    elif message.author.id == manager_id and message.channel.id == channel:
        if message.content.startswith("owo cf "):
            message_ids[0] = message.id

        elif message.content in lst:

            if dellRandoms:
                await DiscordClient.sil(message.id, server_id=server_id, channel_id=channel)

            else:
                message_ids[1] = message.id

        elif message.content == f"{prefix}komutlar" or message.content == f"{prefix}yardƒ±m" or message.content == f"{prefix}help":
            embed = discord.Embed(
                title="„Ö§„Ö§„Ö§„Ö§„Ö§„Ö§„Ö§„Ö§„Ö§„Ö§„Ö§ü§ñ OwO Farm Bot ü§ñ"+"\n\nüìú Yardƒ±m Men√ºs√º",
                description="**Botun kullanƒ±labilir komutlarƒ± a≈üaƒüƒ±da listelenmi≈ütir :** ",
                color=discord.Color.gold()
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
        
            embed.add_field(
                name=f"üîß {prefix}randoms a√ß/kapa",
                value="* **Random mesajlarƒ± a√ßar veya kapatƒ±r. (default=kapalƒ±)**",
                inline=False
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
            embed.add_field(
                name=f"‚è∏Ô∏è {prefix}durdur",
                value="* **Botu dondurur.**",
                inline=False
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
            embed.add_field(
                name=f"‚ñ∂Ô∏è {prefix}ba≈ülat",
                value="* **Botu devam ettirir.**",
                inline=False
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
            embed.add_field(
                name=f"üîí {prefix}captchaprotect a√ß/kapa/cf_limit",
                value="* **Captcha korumasƒ±nƒ± a√ßar, kapatƒ±r veya mesaj limitini ayarlar. (default=a√ßƒ±k)**",
                inline=False
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
            embed.add_field(
                name=f"üçÄ {prefix}pray a√ß/kapa",
                value="* **Botun otomatik olarak owo pray almasƒ±nƒ± saƒülar. (default=a√ßƒ±k)**",
                inline=False
            )
            embed.add_field(
                name=f"üí∞ {prefix}miktar ba≈ülangƒ±√ß_miktarƒ±",
                value="* **Ba≈ülangƒ±√ß miktarƒ±nƒ± g√∂sterir veya deƒüi≈ütirir.**",
                inline=False
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
            embed.add_field(
                name=f"üìà {prefix}kar-zarar",
                value="* **Ba≈ülangƒ±√ßtan baz alarak kar-zarar durumunu g√∂sterir.(√áok fazla g√∂sterebiliyor.)**",
                inline=False
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
            embed.add_field(
                name=f"üî§ {prefix}prefix ayarlanacak_prefix",
                value="* **Botun ge√ßerli prefix'ini deƒüi≈ütirir.**",
                inline=False
            )
            embed.add_field(
                name='\u200B',
                value='',
                inline=False
            )
            embed.add_field(
                name=f"‚ùì {prefix}yardƒ±m/komutlar/help",
                value="* **Yardƒ±m men√ºs√ºn√º g√∂sterir.**",
                inline=False
            )
        
            embed.set_footer(
                text="-# Coded by berkwe_",
            )
        

            await message.channel.send(embed=embed)
        elif message.content.startswith(f"{prefix}pray"):

            if len(message.content.split()) == 2:

                if message.content.split()[1] == "a√ß":
                    if owoPray:
                        await message.channel.send(f"<@{message.author.id}> **Oto Pray** zaten a√ßƒ±k!")

                    else:
                        owoPray = True
                        await message.channel.send(f"<@{message.author.id}> **Oto Pray** a√ßƒ±ldƒ±!")

                elif message.content.split()[1] == "kapa" or message.conten.split()[1] == "kapat":

                    if not owoPray:
                        await message.channel.send(f"<@{message.author.id}> **Oto Pray** zaten kapalƒ±!")

                    else:
                        owoPray = False
                        await message.channel.send(f"<@{message.author.id}> **Oto Pray** kapatƒ±ldƒ±!")

                else:
                    await message.channel.send(f"<@{message.author.id}> L√ºtfen sadece a√ß/kapa kullanƒ±n!")

            else:
                await message.channel.send(f"<@{message.author.id}> Bu komut ≈üu ≈üekilde kullanƒ±lmalƒ±dƒ±r : {prefix}pray a√ß/kapa")

        elif message.content.startswith(f"{prefix}prefix"):

            if len(message.content.split()) == 2:

                if message.content.split()[1] == prefix:
                    await message.channel.send(f"<@{message.author.id}> Prefix zaten {prefix}")

                else:
                    try:
                        int(message.content.split()[1])
                        await message.channel.send(f"<@{message.author.id}> Prefix'i sayƒ± olarak ayarlayamazsƒ±n!")
                    except ValueError:
                        prefix = message.content.split()[1]
                        await message.channel.send(f"<@{message.author.id}> Prefix {prefix} olarak ayarlandƒ±!")
                
            else:
                await message.channel.send(f"<@{message.author.id}> Komut ≈ü√∂yle kullanƒ±lmalƒ±dƒ±r : {prefix}randoms ayarlanacak_prefix")

        elif message.content == f"{prefix}kar-zarar":
            await profit_loss(message)
        

        elif message.content.startswith(f"{prefix}randoms"):
            if len(message.content.split()) == 2:

                if message.content.split()[1] == "a√ß":

                    if not dellRandoms:
                        await message.channel.send(f"<@{message.author.id}> Randoms zaten a√ßƒ±k.")

                    else:
                        dellRandoms = False
                        await message.channel.send(f"<@{message.author.id}> Artƒ±k random mesajlar silinmeyecek")
                        print("\nLOG : DellRandoms kapatƒ±ldƒ±.")

                elif message.content.split()[1] == "kapa":
                    if dellRandoms:
                        await message.channel.send(f"<@{message.author.id}> Randoms zaten kapalƒ±.")
                    else:
                        dellRandoms = True
                        await message.channel.send(f"<@{message.author.id}> Artƒ±k random mesajlar silinecek.")
                        print("\nLOG : DellRandoms a√ßƒ±ldƒ±.")

                else:
                    await message.channel.send(f"<@{message.author.id}> L√ºtfen sadece a√ß veya kapa girin.")

            else:
                await message.channel.send(f"<@{message.author.id}> Komut ≈ü√∂yle kullanƒ±lmalƒ±dƒ±r : {prefix}randoms a√ß/kapa")

        elif message.content == f"{prefix}durdur":
            main_task.cancel()
            isCont = False
            isPause = True
            await message.channel.send(f"<@{message.author.id}> Bot ba≈üarƒ±yla durduruldu!")
            print("\nLOG : Bot durduruldu.")

        elif message.content == f"{prefix}ba≈ülat":
            isCont = True
            isPause = False
            await message.channel.send(f"<@{message.author.id}> Bot ba≈üarƒ±yla ba≈ülatƒ±ldƒ±!")
            main_task = asyncio.create_task(main())
            await main_task

        elif message.content.startswith(f"{prefix}captchaprotect"):

            if len(message.content.split()) == 2:

                if message.content.split()[1] == "a√ß":

                    if captchaProtection:
                        await message.channel.send(f"<@{message.author.id}> captcha Protection zaten a√ßƒ±k.")

                    else:
                        cfValue[1] = 1
                        cfValue[0] = 1
                        captchaProtection = True
                        await message.channel.send(f"<@{message.author.id}> Artƒ±k her **{cfLimit}** mesajda bot 3 dakika bekleyecek.")
                        print("\nLOG : captcha Protection a√ßƒ±ldƒ±.")

                elif message.content.split()[1] == "kapa" or message.content.split()[1] == "kapat":

                    if not captchaProtection:
                        await message.channel.send(f"<@{message.author.id}> Captcha Protection zaten kapalƒ±.")

                    else:
                        captchaProtection = False
                        await message.channel.send(f"<@{message.author.id}> Artƒ±k Captcha protection kapalƒ±.")
                        print("\nLOG : Captcha protection kapandƒ±.")

                else:
                    try:
                        cfLimit = int(message.content.split()[1])
                        if cfLimit > 4:
                            await message.channel.send(f"<@{message.author.id}> Mesaj limiti **{cfLimit}** olarak ayarlandƒ±.")
                            cfValue[1] = 1
                            cfValue[0] = 1
                        else:
                            cfLimit = 30
                            await message.channel.send(f"<@{message.author.id}> Mesaj limiti en az 5 olmalƒ±dƒ±r.")
                    except ValueError:
                        await message.channel.send(f"<@{message.author.id}> L√ºtfen sadece a√ß veya kapa girin, mesaj limitini deƒüi≈ütirmek isterseniz sayƒ± girin.")
                    
            else:
                await message.channel.send(f"<@{message.author.id}> Komut ≈ü√∂yle kullanƒ±lmalƒ±dƒ±r : {prefix}captchaprotect a√ß/kapa/cf_limit")

        elif message.content.startswith(f"{prefix}miktar"):

            if len(message.content.split()) == 1:
                await message.channel.send(f"<@{message.author.id}> ≈ûuanki ba≈ülangƒ±√ß miktarƒ± : {defaultAmount}")

            elif len(message.content.split()) == 2:
                try:
                    defaultAmount = int(message.content[7:])
                    await message.channel.send(f"<@{message.author.id}> Ba≈ülangƒ±√ß miktarƒ± ba≈üarƒ±yla deƒüi≈ütirildi!")
                    print("LOG : Ba≈ülangƒ±√ß miktarƒ± deƒüi≈ütirildi.")

                except ValueError:
                    await message.channel.send(f"<@{message.author.id}> L√ºtfen bir sayƒ± girin!")

            else:
                await message.channel.send(f"<@{message.author.id}> Komut ≈ü√∂yle kullanƒ±lmalƒ±dƒ±r : {prefix}miktar ba≈ülangƒ±√ß_miktarƒ±")




@bot.event
async def on_message_edit(before, after):
    global won, isCont, losingStreak, main_task, hebele, cfValue, amount, isPause, cashControlVal, owoPray, prayTime
    if after.author.id == bot_id and after.channel.id == channel:

        if "you won" in after.content:
            won = True
            cashControlVal += (amount//2) if cashControlVal != 0 else defaultAmount
            losingStreak = 0
            print(f"\nLOG : KAZANILDI, {defaultAmount}")
            cfValue[0] += 1
            
            
            if captchaProtection and cfValue[0] >= cfLimit:
                cfValue[1] = 1
                cfValue[0] = 1
                messsages = await after.channel.send(f"<@{manager_id}> Captcha korumasƒ± i√ßin 4 dakika beklenecek. Bot, **<t:{int(time.time())+240}:R>** aktive olacak.")
                print("\nLOG : Waiting 3 min for captchaProtection.")
                hebele = True
                isCont = False
                main_task.cancel()

                await asyncio.sleep(240)
                await messsages.delete()
                hebele = False
                if not isPause:
                    isCont = True
                    main_task = asyncio.create_task(main())
                    await main_task

        elif "you lost" in after.content:
            cashControlVal -= defaultAmount if losingStreak == 0 else amount//2
            print(cashControlVal)
            losingStreak += 1
            print(f"\nLOG : KAYBEDƒ∞LDƒ∞")
            cfValue[0] += 1

            if losingStreak == 5:
                isCont = False
                main_task.cancel()
                
                losingStreak = 0
                print("\nLOG : Losing streak, sleeping 45 seconds...")
                message = await after.channel.send(f"Kaybetme serisi 5'e ula≈ütƒ±, program  **<t:{int(time.time())+46}:R>** √ßalƒ±≈üacak. Bir sonraki miktar : {amount}")
                await asyncio.sleep(45)
                await message.delete()
                if not isPause:
                    isCont = True
                    main_task = asyncio.create_task(main())
                    await main_task

    if owoPray and int(time.time())-prayTime > 250:
        await DiscordClient.g√∂nder(message="owo pray", server_id=server_id, channel_id=channel)
        prayTime = int(time.time())

    

if __name__ == "__main__":
    bot.run(TOKEN)